<head>
  <title>popr</title>
  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <script src="node_modules/keyboardevent-key-polyfill/index.js"></script>
  <script>keyboardeventKeyPolyfill.polyfill();</script>
  <script src="node_modules/jquery.terminal/js/jquery.terminal.min.js"></script>
  <link href="css/jquery.terminal.css" rel="stylesheet"/>
</head>
<body>
  <div id="term"></div>
</body>
<script>
  var term;
  var Module = {
    'print' : function(str) { term.echo(str); },
    'printErr' : function(str) { term.echo(str); },
  };

  var is_ready = false;

  function eval_popr(str) {
    return Module.ccall('emscripten_eval', 'number', ['string', 'number'], [str, str.length]);
  }

  Module['onRuntimeInitialized'] = function() {
    is_ready = true;
  }

  function interpret(command, term) {
    if(!is_ready) {
      term.echo("not ready");
    } else {
      if(command != '') {
        eval_popr(command)
      }
    }
  }

  var termOptions = {
    prompt: ': ',
    greetings: "          ,------------------,\n" +
               " ,--------' Popr Interpreter '--------,\n" +
               " | [[;#f00;;]Copyright 2013-2017 Dustin DeWeese] |\n" +
               " '------------------------------------'\n" +
               "   type :help for help\n \n",
    onClear: function(term) {
      term.echo(this.greetings);
    }
  }

  jQuery(document).ready(function($) {
    term = $('#term').terminal(interpret, termOptions);
    $.getScript( "js/eval.js");
  });

</script>
