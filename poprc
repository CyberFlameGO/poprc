#!/bin/bash

LIBS="*.ppr"
LOAD=""

CFLAGS="-g -O0"
if [[ "$1" == "-O" ]]; then
    CFLAGS="-g -DNDEBUG -O2"
    shift
fi

OUT=`./eval -ident $1`
DIR=poprc_out

set -x
mkdir -p $DIR
./eval -lo ${LIBS} -main $1 -cc $1 > ${DIR}/${OUT}.c
clang -S -emit-llvm ${CFLAGS} -DNOLOG -I. -I.gen -o ${DIR}/${OUT}.ll ${DIR}/${OUT}.c
clang ${CFLAGS} -DNOLOG -I. -I.gen -o ${DIR}/${OUT} ${DIR}/${OUT}.c cgen/parse_args.c startle/support.c startle/error.c startle/log.c tok.c
